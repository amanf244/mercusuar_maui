<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:MauiApp2.PageModels"
             xmlns:helpers="clr-namespace:MauiApp2.Helpers"
             xmlns:pullToRefresh="clr-namespace:Syncfusion.Maui.Toolkit.PullToRefresh;assembly=Syncfusion.Maui.Toolkit"
             x:Class="MauiApp2.Pages.MainPage"
             x:DataType="pageModels:MainPageModel"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             Title="{Binding Today}">

    

    <ContentPage.Resources>
        <ResourceDictionary>
            <helpers:TemperatureToColorConverter x:Key="TemperatureColorConverter" />
            <helpers:StatusToColorConverter x:Key="StatusColorConverter" />
            <helpers:InvertedBoolConverter x:Key="InvertedBoolConverter" />

            <Style x:Key="CardTitle" TargetType="Label">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="TextColor" Value="#607D8B"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="FontAttributes" Value="Bold"/>
            </Style>

            <Style x:Key="SensorValue" TargetType="Label">
                <Setter Property="FontSize" Value="36"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="VerticalOptions" Value="Center"/>
            </Style>

            <Style x:Key="DeviceStatus" TargetType="Label">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="Margin" Value="0,10,0,0"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <pullToRefresh:SfPullToRefresh
        IsRefreshing="{Binding IsRefreshing}"
        RefreshCommand="{Binding RefreshCommand}"
        BackgroundColor="Transparent">

        <pullToRefresh:SfPullToRefresh.PullableContent>
            <VerticalStackLayout Spacing="20" Padding="20">
                <!-- Sensor Section -->
                <Grid ColumnDefinitions="*,*" 
                      RowDefinitions="Auto,Auto"
                      ColumnSpacing="15"
                      RowSpacing="15">

                    <!-- Temperature -->
                    <Border Grid.Row="0" Grid.Column="0"
                            BackgroundColor="#FFFFFF"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 15"
                            Padding="15">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="🌡 TEMPRATUR" Style="{StaticResource CardTitle}"/>
                            <Label Text="{Binding Temperature, StringFormat='{0}°C'}" 
                                   Style="{StaticResource SensorValue}"
                                   TextColor="{Binding Temperature, Converter={StaticResource TemperatureColorConverter}}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Humidity -->
                    <Border Grid.Row="0" Grid.Column="1"
                            BackgroundColor="#FFFFFF"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 15"
                            Padding="15">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="💧 KELEMBAPAN" Style="{StaticResource CardTitle}"/>
                            <Label Text="{Binding Humidity, StringFormat='{0}%'}" 
                                   Style="{StaticResource SensorValue}"
                                   TextColor="#2196F3"/>
                        </VerticalStackLayout>
                    </Border>

                </Grid>

                <!-- Devices Section -->
                <Grid ColumnDefinitions="*,*"
                      ColumnSpacing="15">

                    <!-- Lamp -->
                    <Border Grid.Column="0"
                            BackgroundColor="#FFFFFF"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 15"
                            Padding="15">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="💡 STATUS LAMPU" Style="{StaticResource CardTitle}"/>
                            <Image Source="{Binding IsLampOn, Converter={StaticResource InvertedBoolConverter}, 
                                                   ConverterParameter='lamp_on.png;lamp_off.png'}"
                                   HeightRequest="60"
                                   Aspect="AspectFit"/>
                            <Label Text="{Binding IsLampOn, Converter={StaticResource InvertedBoolConverter}, 
                                                StringFormat='Lampu {0}'}"
                                   Style="{StaticResource DeviceStatus}"
                                   TextColor="{Binding IsLampOn, Converter={StaticResource StatusColorConverter}}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Fan -->
                    <Border Grid.Column="1"
                            BackgroundColor="#FFFFFF"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 15"
                            Padding="15">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="🌀 STATUS KIPAS" Style="{StaticResource CardTitle}"/>
                            <Image Source="{Binding IsFanOn, Converter={StaticResource InvertedBoolConverter}, 
                                                   ConverterParameter='fan_on.png;fan_off.png'}"
                                   HeightRequest="60"
                                   Aspect="AspectFit"/>
                            <Label Text="{Binding IsFanOn, Converter={StaticResource InvertedBoolConverter}, 
                                                StringFormat='Kipas {0}'}"
                                   Style="{StaticResource DeviceStatus}"
                                   TextColor="{Binding IsFanOn, Converter={StaticResource StatusColorConverter}}"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

            </VerticalStackLayout>
        </pullToRefresh:SfPullToRefresh.PullableContent>
    </pullToRefresh:SfPullToRefresh>
</ContentPage>